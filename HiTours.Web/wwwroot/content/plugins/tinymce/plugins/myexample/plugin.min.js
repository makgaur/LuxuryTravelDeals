tinymce.PluginManager.add('myexample', function (editor, url) {
    var self = this, button;

    function getValues() {
        alert('call getValues');
        console.log(editor.settings.myKeyValueList);

        return editor.settings.myKeyValueList;
    }
    // Add a button that opens a window
    editor.addButton('myexample', {
        type: 'listbox',
        text: 'My Example',
        values: [{ text: 'Menu item 2', value: 'newvalue' }],
        onselect: function () {
            //insert key
            editor.insertContent(this.value());

            //reset selected value
            this.value(null);
        },
        onPostRender: function () {
            //this is a hack to get button refrence.
            //there may be a better way to do this
            button = this;
        },
    });

    self.refresh = function () {
        //remove existing menu if it is already rendered
        if (button.menu) {
            //button.menu.remove();
            //button.menu = null;
        }
        var listMenu = getValues();
        console.log(listMenu);

        ////$.each(listMenu, function (item) {
        ////    button.menu.add(item);
        ////}) 
        ////button.menu.refresh();

        button.settings.menu = listMenu;
        //button.settings.values = listMenu;
    };
});